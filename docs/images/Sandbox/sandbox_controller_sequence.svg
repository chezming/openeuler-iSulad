<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="429px" preserveAspectRatio="none" style="width:870px;height:429px;background:#FFFFFF;" version="1.1" viewBox="0 0 870 429" width="870px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="176.8633" style="stroke:#000000;stroke-width:1.5;" width="560.5" x="303.5" y="200.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="129" x2="129" y1="36.4883" y2="393.9043"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="262.5" x2="262.5" y1="36.4883" y2="393.9043"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="376.5" x2="376.5" y1="36.4883" y2="393.9043"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="549" x2="549" y1="36.4883" y2="393.9043"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="658" x2="658" y1="36.4883" y2="393.9043"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="785" x2="785" y1="36.4883" y2="393.9043"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="48" x="105" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="112" y="25.5352">main</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="48" x="105" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="112" y="413.4395">main</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="222.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="229.5" y="25.5352">controller</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="222.5" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="229.5" y="413.4395">controller</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="313.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="320.5" y="25.5352">Proxy Controller</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="313.5" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="320.5" y="413.4395">Proxy Controller</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="498" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="505" y="25.5352">isulad config</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="498" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="505" y="413.4395">isulad config</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="610" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="617" y="25.5352">Proxy Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="610" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="617" y="413.4395">Proxy Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="137" x="717" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="724" y="25.5352">Proxy gRPC Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="137" x="717" y="392.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="724" y="413.4395">Proxy gRPC Client</text><polygon fill="#181818" points="117,63.7988,127,67.7988,117,71.7988,121,67.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="0" x2="123" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="7" y="63.0566">pre_init_daemon</text><polygon fill="#181818" points="251,93.1094,261,97.1094,251,101.1094,255,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="129" x2="257" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="136" y="92.3672">sandbox_ctrl_init</text><polygon fill="#181818" points="365,122.4199,375,126.4199,365,130.4199,369,126.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="263" x2="371" y1="126.4199" y2="126.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="270" y="121.6777">init</text><polygon fill="#181818" points="537,151.7305,547,155.7305,537,159.7305,541,155.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="543" y1="155.7305" y2="155.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="384" y="150.9883">conf_get_server_conf</text><polygon fill="#181818" points="388,181.041,378,185.041,388,189.041,384,185.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="548" y1="185.041" y2="185.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="394" y="180.2988">configured_sandboxers</text><path d="M303.5,200.041 L377.5,200.041 L377.5,207.3516 L367.5,217.3516 L303.5,217.3516 L303.5,200.041 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="176.8633" style="stroke:#000000;stroke-width:1.5;" width="560.5" x="303.5" y="200.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="318.5" y="213.6094">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="235" x="392.5" y="212.6758">[for sandboxer in configured_sandboxers]</text><polygon fill="#181818" points="646.5,234.6621,656.5,238.6621,646.5,242.6621,650.5,238.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="652.5" y1="238.6621" y2="238.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="384" y="233.9199">ctrl_client_new</text><polygon fill="#181818" points="773.5,263.9727,783.5,267.9727,773.5,271.9727,777.5,267.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="658.5" x2="779.5" y1="267.9727" y2="267.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="665.5" y="263.2305">new_client</text><polygon fill="#181818" points="669.5,293.2832,659.5,297.2832,669.5,301.2832,665.5,297.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="663.5" x2="784.5" y1="297.2832" y2="297.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="675.5" y="292.541">client_base</text><polygon fill="#181818" points="388,322.5938,378,326.5938,388,330.5938,384,326.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="657.5" y1="326.5938" y2="326.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="394" y="321.8516">client_base</text><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="419" y1="355.9043" y2="355.9043"/><line style="stroke:#181818;stroke-width:1.0;" x1="419" x2="419" y1="355.9043" y2="368.9043"/><line style="stroke:#181818;stroke-width:1.0;" x1="378" x2="419" y1="368.9043" y2="368.9043"/><polygon fill="#181818" points="388,364.9043,378,368.9043,388,372.9043,384,368.9043" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="384" y="351.1621">add_to_map</text><!--MD5=[cf360a8ddc1fecd0cdb0d8c02426f9f7]
@startuml
participant main
participant controller
participant "Proxy Controller" as proxy
participant "isulad config" as config
participant "Proxy Client" as client
participant "Proxy gRPC Client" as grpc

->main: pre_init_daemon
main -> controller: sandbox_ctrl_init
controller -> proxy: init
proxy -> config: conf_get_server_conf
proxy <- - config: configured_sandboxers

loop for sandboxer in configured_sandboxers
    proxy -> client: ctrl_client_new
    client -> grpc: new_client
    client <- - grpc: client_base
    proxy <- - client: client_base
    proxy -> proxy: add_to_map
end

@enduml

PlantUML version 1.2022.7(Tue Aug 23 01:01:30 CST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: CN
--></g></svg>