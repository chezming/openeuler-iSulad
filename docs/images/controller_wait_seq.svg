<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="815px" preserveAspectRatio="none" style="width:907px;height:815px;background:#FFFFFF;" version="1.1" viewBox="0 0 907 815" width="907px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="356.0058" style="stroke:#000000;stroke-width:1.5;" width="890" x="10" y="404.8341"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="142" x2="142" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="255" x2="255" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="422.5" x2="422.5" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="591.5" x2="591.5" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="758" x2="758" y1="39.0679" y2="777.8399"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="844" x2="844" y1="39.0679" y2="777.8399"/><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="27" y="26.9659">Sandbox</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="72" x="20" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="27" y="798.8059">Sandbox</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="102" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="109" y="26.9659">Controller</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="102" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="109" y="798.8059">Controller</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="193" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="200" y="26.9659">SandboxerClient</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="193" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="200" y="798.8059">SandboxerClient</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="180" x="332.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="339.5" y="26.9659">SandboxerAsyncWaitCall</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="180" x="332.5" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="339.5" y="798.8059">SandboxerAsyncWaitCall</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="522.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="529.5" y="26.9659">SandboxerMonitor</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="522.5" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="529.5" y="798.8059">SandboxerMonitor</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58" x="729" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="736" y="26.9659">Future</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58" x="729" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="736" y="798.8059">Future</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="798" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="805" y="26.9659">gRPCServer</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="798" y="776.8399"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="805" y="798.8059">gRPCServer</text><polygon fill="#181818" points="130.5,68.7739,140.5,72.7739,130.5,76.7739,134.5,72.7739" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="136.5" y1="72.7739" y2="72.7739"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="63" y="66.9649">Wait</text><polygon fill="#181818" points="243.5,100.4799,253.5,104.4799,243.5,108.4799,247.5,104.4799" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="142.5" x2="249.5" y1="104.4799" y2="104.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="149.5" y="98.6709">Wait</text><polygon fill="#181818" points="410.5,132.186,420.5,136.186,410.5,140.186,414.5,136.186" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="255.5" x2="416.5" y1="136.186" y2="136.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="262.5" y="130.377">Create Instance callData</text><polygon fill="#181818" points="266.5,163.892,256.5,167.892,266.5,171.892,262.5,167.892" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.5" x2="421.5" y1="167.892" y2="167.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="272.5" y="162.083">callData</text><polygon fill="#181818" points="580,195.598,590,199.598,580,203.598,584,199.598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="255.5" x2="586" y1="199.598" y2="199.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="262.5" y="193.789">Monitor(callData)</text><polygon fill="#181818" points="832,227.304,842,231.304,832,235.304,836,231.304" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="592" x2="838" y1="231.304" y2="231.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="599" y="225.495">AsyncWait</text><polygon fill="#181818" points="266.5,259.01,256.5,263.01,266.5,267.01,262.5,263.01" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="260.5" x2="591" y1="263.01" y2="263.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="272.5" y="257.201">Wait OK</text><polygon fill="#181818" points="153.5,290.716,143.5,294.716,153.5,298.716,149.5,294.716" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="147.5" x2="254.5" y1="294.716" y2="294.716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="159.5" y="288.907">Wait OK</text><polygon fill="#181818" points="67,322.4221,57,326.4221,67,330.4221,63,326.4221" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="141.5" y1="326.4221" y2="326.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="73" y="320.6131">Wait OK</text><polygon fill="#181818" points="603,354.1281,593,358.1281,603,362.1281,599,358.1281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="597" x2="843" y1="358.1281" y2="358.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="609" y="352.3191">WaitReply</text><polygon fill="#181818" points="433.5,385.8341,423.5,389.8341,433.5,393.8341,429.5,389.8341" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="427.5" x2="591" y1="389.8341" y2="389.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="439.5" y="384.0251">HandleResponse</text><path d="M10,404.8341 L73,404.8341 L73,414.5401 L63,424.5401 L10,424.5401 L10,404.8341 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="356.0058" style="stroke:#000000;stroke-width:1.5;" width="890" x="10" y="404.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="25" y="419.7311">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136" x="88" y="418.593">[WaitReply.Status == OK]</text><polygon fill="#181818" points="67,444.2461,57,448.2461,67,452.2461,63,448.2461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="421.5" y1="448.2461" y2="448.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="73" y="442.4371">OnSandboxExit(ok, exitinfo)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="900" y1="457.2461" y2="457.2461"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="15" y="469.005">[WaitReply.Status == NotFound]</text><polygon fill="#181818" points="67,492.934,57,496.934,67,500.934,63,496.934" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="421.5" y1="496.934" y2="496.934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="73" y="491.125">OnSandboxExit(false)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="900" y1="505.934" y2="505.934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="182" x="15" y="517.6929">[WaitReply.Status == UNKNOWN]</text><polygon fill="#181818" points="67,541.6219,57,545.6219,67,549.6219,63,545.6219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="421.5" y1="545.6219" y2="545.6219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="73" y="539.8129">OnSandboxExit(false)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="900" y1="554.6219" y2="554.6219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="197" x="15" y="566.3809">[WaitReply.Status == UNAVAILABLE]</text><polygon fill="#181818" points="67,590.3098,57,594.3098,67,598.3098,63,594.3098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="421.5" y1="594.3098" y2="594.3098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="73" y="588.5008">OnSandboxPending()</text><polygon fill="#181818" points="580,622.0159,590,626.0159,580,630.0159,584,626.0159" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="422.5" x2="586" y1="626.0159" y2="626.0159"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="429.5" y="620.2069">Retry DeferredCall</text><polygon fill="#181818" points="746,653.7219,756,657.7219,746,661.7219,750,657.7219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="592" x2="752" y1="657.7219" y2="657.7219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="599" y="651.9129">Issue deferred call</text><polygon fill="#181818" points="832,685.4279,842,689.4279,832,693.4279,836,689.4279" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="758" x2="838" y1="689.4279" y2="689.4279"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="765" y="683.6189">AsyncWait</text><polygon fill="#181818" points="603,717.1339,593,721.1339,603,725.1339,599,721.1339" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="597" x2="757" y1="721.1339" y2="721.1339"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="609" y="715.3249">Channel alive and ready</text><polygon fill="#181818" points="67,748.8399,57,752.8399,67,756.8399,63,752.8399" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="61" x2="591" y1="752.8399" y2="752.8399"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="73" y="747.0309">OnSandboxReady()</text><!--MD5=[826e29f5b7b2101dd95725a6e99c93e1]
@startuml
participant "Sandbox" as Sandbox
participant "Controller" as Controller
participant "SandboxerClient" as SandboxerClient
participant "SandboxerAsyncWaitCall" as SandboxerAsyncWaitCall
participant "SandboxerMonitor" as SandboxerMonitor
participant "Future" as Future
participant "gRPCServer" as gRPCServer


Sandbox -> Controller: Wait
Controller -> SandboxerClient: Wait
SandboxerClient -> SandboxerAsyncWaitCall: Create Instance callData
SandboxerAsyncWaitCall -> SandboxerClient: callData
SandboxerClient -> SandboxerMonitor: Monitor(callData)
SandboxerMonitor - -> gRPCServer: AsyncWait
SandboxerMonitor -> SandboxerClient: Wait OK
SandboxerClient -> Controller: Wait OK
Controller -> Sandbox: Wait OK

gRPCServer - -> SandboxerMonitor: WaitReply
SandboxerMonitor -> SandboxerAsyncWaitCall: HandleResponse
alt WaitReply.Status == OK
    SandboxerAsyncWaitCall -> Sandbox: OnSandboxExit(ok, exitinfo)
else WaitReply.Status == NotFound
    SandboxerAsyncWaitCall -> Sandbox: OnSandboxExit(false)
else WaitReply.Status == UNKNOWN
    SandboxerAsyncWaitCall -> Sandbox: OnSandboxExit(false)
else WaitReply.Status == UNAVAILABLE
    SandboxerAsyncWaitCall -> Sandbox: OnSandboxPending()
    SandboxerAsyncWaitCall -> SandboxerMonitor: Retry DeferredCall
    SandboxerMonitor - -> Future: Issue deferred call
    Future - -> gRPCServer: AsyncWait
    Future - -> SandboxerMonitor: Channel alive and ready
    SandboxerMonitor -> Sandbox: OnSandboxReady()
end
@enduml

PlantUML version 1.2022.7(Tue Aug 23 01:01:30 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>